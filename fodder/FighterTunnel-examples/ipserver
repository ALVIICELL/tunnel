ipserver() {
    iptables -A INPUT -i eth0 -p tcp -m state --state NEW -m multiport --dports ssh,smtp,http,https -j ACCEPT
    iptables -A INPUT -p tcp -m multiport --dports 80,443 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
    iptables -A OUTPUT -p tcp -m multiport --dports 80,443 -m conntrack --ctstate ESTABLISHED -j ACCEPT
    iptables -A INPUT -p tcp -m multiport --dports 10012,10015,18020,10030,10040 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
    iptables -A OUTPUT -p tcp -m multiport --dports 10012,10015,18020,10030,10040 -m conntrack --ctstate ESTABLISHED -j ACCEPT
    iptables -A INPUT -p tcp -m multiport --dports 10000,10001,10002,10003,10004,10005,10006,10007,10008 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
    iptables -A OUTPUT -p tcp -m multiport --dports 10000,10001,10002,10003,10004,10005,10006,10007,10008 -m conntrack --ctstate ESTABLISHED -j ACCEPT
    iptables -A FORWARD -m string --algo bm --string "BitTorrent" -j DROP
    iptables -A FORWARD -m string --algo bm --string "BitTorrent protocol" -j DROP
    iptables -A FORWARD -m string --algo bm --string "peer_id=" -j DROP
    iptables -A FORWARD -m string --algo bm --string ".torrent" -j DROP
    iptables -A FORWARD -m string --algo bm --string "announce.php?passkey=" -j DROP
    iptables -A FORWARD -m string --algo bm --string "torrent" -j DROP
    iptables -A FORWARD -m string --algo bm --string "announce" -j DROP
    iptables -A FORWARD -m string --algo bm --string "info_hash" -j DROP
    iptables -A FORWARD -m string --algo bm --string "/default.ida?" -j DROP
    iptables -A FORWARD -m string --algo bm --string ".exe?/c+dir" -j DROP
    iptables -A FORWARD -m string --algo bm --string ".exe?/c_tftp" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "peer_id" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "BitTorrent" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "BitTorrent protocol" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "bittorrent-announce" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "announce.php?passkey=" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "find_node" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "info_hash" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "get_peers" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "announce" -j DROP
    iptables -A FORWARD -m string --algo kmp --string "announce_peers" -j DROP
    iptables -t nat -I POSTROUTING -s 10.6.0.0/24 -o eth0 -j MASQUERADE
    iptables -t nat -I POSTROUTING -s 10.7.0.0/24 -o eth0 -j MASQUERADE
    iptables -I INPUT -p udp --dport 5300 -j ACCEPT
    iptables -t nat -I PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 5300
}
ipserver
echo 1 >/proc/sys/net/ipv4/ip_forward
sed -i 's/net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g' /etc/sysctl.conf
iptables-save >/etc/iptables/rules.v4 >/dev/null 2>&1
iptables-save >/etc/iptables.up.rules >/dev/null 2>&1
netfilter-persistent save >/dev/null 2>&1
netfilter-persistent reload >/dev/null 2>&1
systemctl enable iptables >/dev/null 2>&1
systemctl start iptables >/dev/null 2>&1
systemctl restart iptables >/dev/null 2>&1
